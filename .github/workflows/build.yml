name: Build Voukoder

on:
  workflow_dispatch:
        
env:
  vsPath: C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\
  
jobs:
  voukoder:
    runs-on: windows-2019
    steps:
    - name: Set up WSL
      uses: Vampire/setup-wsl@v1.2.0
      with:
        additional-packages:
          curl
          wget
    - name: Set up dependencies
      shell: wsl-bash {0}
      run: |
        wget -q --no-check-certificate https://github.com/vouk/voukoder-ffmpeg/releases/latest/download/ffmpeg-win64-static-release.tar.gz
        mkdir external project
        tar zxf ffmpeg-win64-static-release.tar.gz -C external
        mkdir external/lib/release
        mv external/lib/*.lib external/lib/release/
#    - name: Set up MSBuild
#      uses: microsoft/setup-msbuild@v1.1
#    - name: Checkout Voukoder
#      uses: actions/checkout@v3.0.0
#      with:
#        path: project\voukoder
    - name: Build X265 (10 bit)
      shell: cmd
      run: |
        rem call "${{ env.vsPath }}VC\Auxiliary\Build\vcvars64.bat"
        dir /s 
#    - name: Publish artifact
#      uses: actions/upload-artifact@v2
#      with:
#        name: x265_10bit
#        path: dist/x265_10bit.lib
